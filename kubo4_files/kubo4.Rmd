---
title: "kubo4.rmd"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
d <- read.csv("/Users/hamaokigaizaburo/Documents/kuboR/intro-statistical-modeling-master/data/data3.csv")
d
```


```{r}
sum(log(dpois(d$y, lambda = d$y)))
```

```{r}
fit.null <- glm(formula = y ~ 1, family = poisson, data = d)
summary(fit.null)
```


```{r}
logLik(fit.null)
```
- 逸脱度(deviance): 「あてはまりの悪さ」を表す.
    - 最大対数尤度を$\log L^{*}$とすると, $-2 \log L^*$ で表される.
- いろいろな逸脱度
    - 残差逸脱度(residual deviance): 「あてはまりの悪さ」の**相対値**
        - $(残差逸脱度) = D - (最小逸脱度)$
        - 最小逸脱度: フルモデルの逸脱度
        - フルモデル(full model): その統計モデルで最も複雑なモデル
            - データ数と同じ数だけのパラメータを使ってあてはめた統計モデル
            - 全データの「読み上げ」に相当する
    - Null逸脱度(null deviance): 残差逸脱度の**最大値**
        - $(Null逸脱度) = (最大逸脱度) - (最小逸脱度)$
        - 最大逸脱度: Nullモデルの逸脱度
        - Nullモデル(null model): 「もっともあてはまりの悪い」モデル
            - 最もパラメータ数の少ないモデル(切片だけ)
            - Rでは`glm(y ~ 1)`で指定可能
    - パラメータ数$k$を増やせば増やすほど残差逸脱度は小さくなる


なぜAICにとるモデル選択が良いのか
- **平均対数尤度**(mean log likelihood): 統計モデルの予測の良さをあらわす量
    1. 手元のデータに対してあるモデルのパラメータを推定する
    2. 「真のモデル」から(同じデータ取得法で)サンプリングを繰り替えして, そのそれぞれの評価済みデータセットに対して対数尤度を評価する
    3. その平均が平均対数尤度: $E(\log L)$
- **バイアス**(bias): $b = \log L^* - E(\log L)$
    - ある統計モデルの$(最大対数尤度) - (平均対数尤度)$
- **バイアス補正**(bias correction)
    - 平均対数尤度のstep.2は「実際には不可能」
    -  $b$の定義を変更して, $E(\log L) = \log L^* - b$とすることで, 平均対数尤度$E(\log L)$の推定をする
        - (-> これ以外には交差検証法(cross-validation)などの方法もある)
    - **平均対数尤度の推定量が$\log L^* - k$であることがであることが解析的かつ一般的に導出されている**
        - $E(\log L)^* = \log L^* - k$
- **AIC: $-2\times E(\log L)^* = -2(\log L^* - k)$**
    - 平均対数尤度は「統計モデルの予測の良さをあらわす量」であるから, AICは「統計モデルの予測の悪さをあらわす量」として解釈できる
    - -> モデル選択とは「予測の悪さが小さいモデルを選ぶ」こと


ネストしているGLM間のAIC比較

- AICは平均対数尤度の推定量であり, それは$b$=(平均対数尤度と最大対数尤度のズレ)が*平均的に*パラメータ数$k$と同じであるという導出に基づいている
- $b$のバラつき(*分散*)は??:=> (同一データに対する)モデルがネストしていれば$b$の分散は小さくなる
    - (2つ以上のモデルが)**ネストにある**(nested): 一方のモデルに他方が含まれていること
        - e.g.) `fit.x`モデルの傾きを0とすれば`fit.null`モデルになるので, これらはネストしている













